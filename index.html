<html>
    <head>
        <script>
            function getValues() {
                var n = document.forms["TVM"]["n"].value*1;
                var I = document.forms["TVM"]["I"].value*1;
                var PV = document.forms["TVM"]["PV"].value*1;
                var PMT = document.forms["TVM"]["PMT"].value*1;
                var FV = document.forms["TVM"]["FV"].value*1;
                var PY = document.forms["TVM"]["P/Y"].value*1;
                var CY = document.forms["TVM"]["C/Y"].value*1;

                var i = fromI(I,PY,CY);

                return {
                    n:n,
                    i:i,
                    PV:PV,
                    PMT:PMT,
                    FV:FV,
                    PY:PY,
                    CY:CY
                };

            }

            function calc(o) {
                var tvm = getValues();
                switch (o) {
                    case 'n': 
                        result = findN(tvm);
                        break;
                    case 'I': 
                        result = findI(tvm);
                        break;
                    case 'PV': 
                        result = findPV(tvm);
                        break; 
                    case 'PMT':                     
                        result = findPMT(tvm);
                        break;
                    case 'FV':
                        result = findFV(tvm);
                        break;
                    default: 
                        //Error
                }
                document.forms["TVM"][o].value = result;
            }

            function findPV(tvm) {
                var PV = (tvm.PMT/tvm.i - tvm.FV)*(1+tvm.i)**(-tvm.n) - tvm.PMT/tvm.i;
                return PV;
            }

            function findPMT(tvm) {
                var PMT = -tvm.i*(tvm.PV+tvm.FV*(1+tvm.i)**(-tvm.n))/(1-(1+tvm.i)**(-tvm.n));
                return PMT;
            }

            function findFV(tvm) {
                var FV = tvm.PMT/tvm.i - (tvm.PV+tvm.PMT/tvm.i)/((1+tvm.i)**(-tvm.n));
                return FV;
            }

            function findN(tvm) {
                var n =(Math.log((tvm.PMT-tvm.FV*tvm.i)/(tvm.PMT+tvm.PV*tvm.i)))/Math.log(1+tvm.i);
                return n;
            }

            function findI(tvm) {
                var iOffset = 0.01;
                var numDec = 7;
                var I = iOffset;

                var test = {...tvm};
                test.i = fromI(I,tvm.PY, tvm.CY);
                
                var goal = tvm.PV;
                var trial = findPV(test);
                for (var prec = 0; prec < numDec; prec++) {
                    while (trial-goal > 0)
                    {
                        I += 1/(10**prec);
                        test.i = fromI(I, tvm.PY, tvm.CY);
                        trial = findPV(test);
                    }
                    I -= 1/(10**prec);
                    if (prec == 0) { I = round(I,numDec);}
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = findPV(test);
                }
            
                return round(I,numDec);
            }

            function toI(i, PY, CY) {
                return (((1+i)**(PY/CY))-1)*CY*100;
            }

            function fromI(I, PY, CY) {
                return (1 + (I/(100*CY)))**(CY/PY) - 1;
            }

            // From https://www.jacklmoore.com/notes/rounding-in-javascript/
            function round(value, decimals) {
                return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
            }
        </script>
    </head>
    <body>
        <form name="TVM">
            <label for="n">n = </label> 
            <input type="text" id="n" name="n" value="24">
            <input type="button" onclick="calc('n')" value = "Solve for n"></br>
    
            <label for="n">I% = </label>
            <input type="text" id="I" name="I" value="10.25">
            <input type="button" onclick="calc('I')" value = "Solve for I%"></br>
    
            <label for="n">PV = </label>
            <input type="text" id="PV" name="PV" value="700">
            <input type="button" onclick="calc('PV')" value = "Solve for PV"></br>
    
            <label for="n">PMT = </label>
            <input type="text" id="PMT" name="PMT" value="-35">
            <input type="button" onclick="calc('PMT')" value = "Solve for PMT"></br>
    
            <label for="n">FV = </label>
            <input type="text" id="FV" name="FV" value="0">
            <input type="button" onclick="calc('FV')" value = "Solve for FV"></br>
    
            <label for="n">P/Y = </label>
            <input type="text" id="PY" name="P/Y" value="12"></br>
    
            <label for="n">C/Y = </label>
            <input type="text" id="CY" name="C/Y" value="12">
        </form>
    </body>
    
</html>
